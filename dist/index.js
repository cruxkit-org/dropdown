import {Container}from'@cruxkit/container';import {Button}from'@cruxkit/button';import {Text}from'@cruxkit/text';import {Divider}from'@cruxkit/divider';import {Icon}from'@cruxkit/icon';import {jsxs,jsx,Fragment}from'@minejs/jsx/jsx-runtime';var S=null;function I(t){let e=t,r=new Set;function n(){return S&&r.add(S),e}function i(u){Object.is(e,u)||(e=u,r.forEach(d=>d()));}function h(u){i(u(e));}function f(){return e}function C(u){return r.add(u),()=>r.delete(u)}let b=n;return b.set=i,b.update=h,b.peek=f,b.subscribe=C,b}function y(t){let e,r=false,n=()=>{if(r)return;e&&(e(),e=void 0);let h=S;S=n;try{let f=t();typeof f=="function"&&(e=f);}finally{S=h;}};n();let i=()=>{r||(r=true,e&&e());};return i}var N=class{constructor(){this.instances=I([]);}register(e,r,n=null){let i=this.calculateLevel(n),h={id:e,parentId:n,close:r,level:i};this.instances.update(f=>[...f,h]);}unregister(e){this.instances.update(r=>r.filter(n=>n.id!==e));}open(e){let r=this.instances().find(i=>i.id===e);if(!r){console.warn("[DropdownManager] Cannot open - dropdown not found:",e);return}this.instances().filter(i=>i.id!==e&&i.level===r.level&&i.parentId===r.parentId).forEach(i=>{i.close();});}close(e){let r=this.instances().find(i=>i.id===e);if(!r)return;this.getChildren(e).forEach(i=>{i.close();}),r.close();}closeFromLevel(e){this.instances().filter(n=>n.level>=e).forEach(n=>{n.close();});}getChildren(e){let r=this.instances().filter(i=>i.parentId===e),n=[...r];return r.forEach(i=>{n.push(...this.getChildren(i.id));}),n}calculateLevel(e){if(!e)return 0;let r=this.instances().find(n=>n.id===e);return r?r.level+1:0}isAncestor(e,r){let n=this.instances().find(i=>i.id===r);for(;n&&n.parentId;){if(n.parentId===e)return  true;n=this.instances().find(i=>i.id===n.parentId);}return  false}getRootParent(e){let r=this.instances().find(n=>n.id===e);for(;r&&r.parentId;)r=this.instances().find(n=>n.id===r.parentId);return r||null}debug(){console.log("[DropdownManager] Registered dropdowns:",this.instances());}},p=new N;var W={sm:{text:"sm",paddingX:3,paddingY:1},md:{text:"md",paddingX:4,paddingY:2},lg:{text:"lg",paddingX:5,paddingY:3}},ee={start:"start-0",center:"start-1/2 -translate-x-1/2",end:"end-0"},D={down:{menu:"top-full",arrow:"bottom-full mb-1"},up:{menu:"bottom-full",arrow:"top-full mt-1"},side:{menu:"top-0 start-full ms-2",arrow:"top-1/2 end-full me-1 -translate-y-1/2"}},te=Container,Y=t=>t==="up"?{width:"0",height:"0",borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderBottom:"6px solid var(--border-1)",borderTop:"0",top:""}:t==="side"?{width:"0",height:"0",borderTop:"6px solid transparent",borderBottom:"6px solid transparent",borderInlineStart:"6px solid var(--border-1)",borderInlineEnd:"0",top:""}:{width:"0",height:"0",borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"6px solid var(--border-1)",borderBottom:"0",top:"-7px"};function we(t){let e=t.size||"md",r=t.position||"end",n=t.direction||"down",i=t.triggerMode||"click",h=t.triggerDisplay||"label-icon",f=t.hoverDelay||150,C=t.styleMode||"arrow",b=t.variant||"ghost",u=t.color||"neutral",d=t.id||`dropdown-${Math.random().toString(36).substr(2,9)}`,J=t.parentId||null,g=I(false),R=I(n),m=null,T=null,E=null,a=null,v=null;y(()=>{t.onOpenChange?.(g());});let F=Y(n);p.register(d,()=>{g.set(false);},J),y(()=>()=>{p.unregister(d),m&&clearTimeout(m);}),y(()=>{if(!g())return;let s=l=>{E&&!E.contains(l.target)&&p.close(d);};return document.addEventListener("click",s),()=>{document.removeEventListener("click",s);}});let j=()=>{if(!a||!E)return;let o=E.getBoundingClientRect(),s=a.classList.contains("hidden");s&&(a.style.visibility="hidden",a.classList.remove("hidden"),a.classList.add("flex"));let l=a.getBoundingClientRect(),w=window.innerWidth,U=window.innerHeight;s&&(a.classList.remove("flex"),a.classList.add("hidden"),a.style.visibility="");let z=H=>H==="down"?o.bottom+l.height+10<=U:H==="up"?o.top-l.height-10>=0:H==="side"?o.right+l.width+10<=w:false,L=n;z(L)||(z("down")?L="down":z("up")?L="up":z("side")&&(L="side")),R.set(L);},O=o=>{o.stopPropagation(),!g()?(j(),p.open(d),g.set(true)):p.close(d);},k=()=>{m&&clearTimeout(m),m=setTimeout(()=>{j(),p.open(d),g.set(true);},f);},$=()=>{m&&clearTimeout(m),m=setTimeout(()=>{p.close(d);},f);},q=(o,s)=>{s||(t.onSelect?.(o),p.close(d));};y(()=>{let o=g();a&&(o?(a.classList.remove("hidden"),a.classList.add("flex")):(a.classList.remove("flex"),a.classList.add("hidden")));}),y(()=>{let o=R();if(a&&(Object.values(D).forEach(s=>{s.menu.split(" ").forEach(l=>a.classList.remove(l));}),D[o].menu.split(" ").forEach(s=>a.classList.add(s)),v&&C==="arrow"&&t.labelArrow)){Object.values(D).forEach(l=>{l.arrow.split(" ").forEach(w=>v.classList.remove(w));}),D[o].arrow.split(" ").forEach(l=>v.classList.add(l));let s=Y(o);Object.assign(v.style,s),o!=="down"&&(v.style.top=""),o==="down"&&(v.style.top="-7px");}}),y(()=>{let o=g();T&&(o?T.classList.add("rotate-180"):T.classList.remove("rotate-180"));});let G=()=>{let o=t.triggerIcon?typeof t.triggerIcon=="string"?jsx(Icon,{name:t.triggerIcon,size:"md"}):jsx(Icon,{...t.triggerIcon}):null,s=()=>t.labelArrow?jsx("span",{ref:w=>{T=w;},className:"transition-transform duration-200 flex items-center w-full justify-between",children:jsx(Icon,{name:"angle-down",size:"xxs"})}):null,l=typeof t.trigger=="string"?jsx(Text,{as:"span",className:"w-full justify-between",size:W[e].text,children:t.trigger}):t.trigger;switch(h){case "icon-only":return jsx(Container,{as:"span",w:"full",justify:"between",display:"inline-flex",align:"center",gap:1,children:o||s()});case "label-only":return jsxs(Container,{as:"span",w:"full",justify:"between",display:"inline-flex",align:"center",gap:2,children:[l,s()]});case "icon-label":return jsxs(Container,{as:"span",w:"full",justify:"between",display:"inline-flex",align:"center",gap:2,children:[l,o,s()]});case "label-icon":default:return jsxs(Container,{as:"span",w:"full",justify:"between",display:"inline-flex",align:"center",gap:2,children:[o,l,s()]})}},K=(()=>{switch(i){case "hover":return {onMouseEnter:k,onMouseLeave:$};case "both":return {onClick:O,onMouseEnter:k,onMouseLeave:$};case "click":default:return {onClick:O}}})(),Q=W[e];return jsxs("div",{ref:o=>{E=o;},className:"dropdown relative inline-block",...i==="hover"||i==="both"?{onMouseEnter:k,onMouseLeave:$}:{},children:[jsx(Button,{variant:b,color:u,size:e,className:t.className+" w-full",...K,children:jsx(Container,{as:"span",w:"full",justify:"between",display:"inline-flex",align:"center",gap:Q.text==="sm"?1:2,children:typeof t.trigger=="string"?G():t.trigger})}),jsx(te,{as:"div",display:"flex",direction:"column",className:`
                        dropdown-menu
                        absolute
                        ${D[n].menu}
                        ${ee[r]}
                        hidden
                        bg-surface
                        shadow-lg
                        z-50
                        py-1
                        ${C==="partof"?"w-full min-w-fit rounded-none border-x border-b border-1 mt-0":`w-full min-w-fit rounded-md border border-1 ${n==="down"?"mt-2":""} ${n==="up"?"mb-2":""}`}
                    `,ref:o=>{a=o;},children:jsxs(Fragment,{children:[C==="arrow"&&t.labelArrow&&jsx("div",{ref:o=>{v=o;},className:`
                                        absolute
                                        ${D[n].arrow}
                                    `,style:F}),t.options.flatMap((o,s)=>{let l=[];o.divider?l.push(jsx(Divider,{color:"1",opacity:50,max:100,thickness:"super-thin",className:"my-1"})):l.push(jsx(Button,{variant:"ghost",color:u,size:e,fullWidth:true,className:`
                                                dropdown-option
                                                justify-start
                                                text-base
                                                text-1
                                                whitespace-nowrap
                                                ${o.disabled?"opacity-50 cursor-not-allowed pointer-events-none":""}
                                            `,onClick:()=>q(o.value,o.disabled),disabled:o.disabled,leftIcon:o.icon,type:"button",children:o.label}));let w=t.options[s+1];return t.autoDivider&&s<t.options.length-1&&!o.divider&&(!w||!w.divider)&&l.push(jsx(Divider,{color:"1",opacity:50,max:100,thickness:"super-thin",className:"my-1"})),l})]})})]})}export{we as Dropdown};//# sourceMappingURL=index.js.map
//# sourceMappingURL=index.js.map